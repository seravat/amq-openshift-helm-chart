---
{{- if eq .Values.subscription.installPlanApproval "Manual"}}
apiVersion: batch/v1  
kind: Job  
metadata:  
  name: {{ print .Values.amq.name "-og" }}-post-delete-hook-job
  annotations:  
    # This is what defines this resource as a hook. Without this line, the  
    # job is considered part of the release.  
    "helm.sh/hook": post-delete 
    "helm.sh/hook-weight": "2" 
    "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
spec:  
  completions: 1    
  activeDeadlineSeconds: 1800 
  backoffLimit: 2
  template:  
    metadata:  
      name: {{ print .Values.amq.name "-og" }}-post-delete-hook-job
    spec:  
      restartPolicy: Never  
      containers:  
      - name: post-delete-job  
        image: "image-registry.openshift-image-registry.svc:5000/openshift/tools:latest"  
        command: ["/bin/bash", "/script/cleanup.sh"]
        volumeMounts:
          - name: script
            mountPath: "/script"
      volumes:
        - name: script
          configMap:
            name: {{ print .Values.amq.name "-og" }}-post-delete-hook-cm
      restartPolicy: Never
{{- end }}